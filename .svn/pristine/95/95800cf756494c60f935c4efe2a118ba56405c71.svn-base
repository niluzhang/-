package presentation.gameui;

import gamemessage.ChangePositionMessage;
import gamemessage.CloseNetMessage;
import gamemessage.CorpGameOverMessage;
import gamemessage.GameStateMessage;
import gamemessage.Game_infoMessage;
import gamemessage.ReNetMessage;

import java.io.IOException;

import javax.swing.JOptionPane;

import main.Startup;
import net.Net;
import presentation.gameresultui.resultGUI;

public class updategui extends Thread{
	collaborationGameGUI game;
	static boolean ggg=false;
	public updategui(collaborationGameGUI game){
		this.game=game;
	}
	@Override
	public void run(){
		ggg=false;
		while(true){
			game.frame.repaint();
			game.frame.validate();
			if(!ggg&&game.time<=60)
			{
				game.layeredpane.remove(game.topPane);
				ggg=true;
			}
			game.gradelabel.setText("   "+game.grade);
			game.timejpb.setValue(game.time);
			game.timelabel3.setText("   " + game.time);
			// timejpb.setToolTipText(""+time);
		
		if (game.time<= 0) {
			
			//	gradetimer.cancel();
			//timeCaulater.cancel();	
			game.remindthread.stop();
			game.updatethread.stop();
			if(game.playerIdentify=="房主"){
				Startup.net.sendMessage(new CorpGameOverMessage());
				
				}
			JOptionPane.showMessageDialog(game.frame, "游戏结束:send:"+game.sendnumber+",receive:"+game.receivenumber+game.playerIdentify);
			game.frame.dispose();
		
		
			while(game.sendnumber>game.receivenumber){
				Game_infoMessage gamems = (Game_infoMessage) Startup.net
						.getMessage(115);
				if(gamems==null){
					ChangePositionMessage ppms = (ChangePositionMessage) Startup.net
							.getMessage(108);
					if(ppms==null){
						GameStateMessage message = (GameStateMessage) Startup.net
								.getMessage(100);
						if(message!=null){
							game.receivenumber++;
						}
					}
				}
			}
			System.out.println(game.sendnumber+"::::"+game.receivenumber);
				Startup.net.sendMessage(new CloseNetMessage());
				try {
					Startup.net=new Net();
					ReNetMessage renet=new ReNetMessage();
					renet.UserID=Startup.window.uif.name;
					Startup.net.sendMessage(renet);
					} catch (IOException e) {
						// TODO Auto-generated catch block
						e.printStackTrace();
					}
			
				resultGUI   resultgui=new resultGUI(game.grade,game.ID,"头像");
				resultGUI.showtime(game.grade);
					game.up.stop();
		}
			try {
				sleep(2);
			} catch (InterruptedException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
	
		}
}
